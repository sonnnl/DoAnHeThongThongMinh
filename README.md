# Forum Th·∫£o Lu·∫≠n - ƒê·ªì √Ån HTTM

D·ª± √°n forum th·∫£o lu·∫≠n t∆∞∆°ng t·ª± VOZ, Reddit v·ªõi t√≠ch h·ª£p AI ph√°t hi·ªán spam, toxic v√† c·∫£m x√∫c.

## üìã T·ªïng Quan

ƒê√¢y l√† ƒë·ªì √°n m√¥n H·ªá th·ªëng Th√¥ng minh, x√¢y d·ª±ng m·ªôt forum th·∫£o lu·∫≠n v·ªõi c√°c t√≠nh nƒÉng:

### T√≠nh NƒÉng Ch√≠nh

#### üôã User Management

- ƒêƒÉng k√Ω/ƒêƒÉng nh·∫≠p (email + password ho·∫∑c Google OAuth)
- Profile v·ªõi avatar, bio, th·ªëng k√™
- H·ªá th·ªëng badge/bi·ªát hi·ªáu: Newbie, Ng∆∞·ªùi t·ª´ng tr·∫£i, Chuy√™n gia, Xem ch√πa
- Tracking: s·ªë ng√†y tham gia, upvotes/downvotes nh·∫≠n ƒë∆∞·ª£c
- Restrictions: ban user, c·∫•m comment/post

#### üìÅ Categories

- Admin t·∫°o categories/subcategories
- Icon, m√†u s·∫Øc, cover image cho m·ªói category
- ƒê·∫øm s·ªë posts, comments, views
- Rules ri√™ng cho t·ª´ng category

#### üìù Posts

- T·∫°o b√†i vi·∫øt v·ªõi title, content (rich text)
- Upload ·∫£nh v√† video (max 25MB)
- Tags
- Upvote/downvote system
- ƒê·∫øm views, comments
- T√≠nh score theo thu·∫≠t to√°n Hot (Reddit-style)
- Pin, lock, feature posts

#### üí¨ Comments

- Nested comments (replies)
- Upload ·∫£nh trong comment
- Ch·ªânh s·ª≠a, x√≥a (soft delete - gi·ªØ structure n·∫øu c√≥ replies)
- Upvote/downvote
- Hi·ªÉn th·ªã "[B√¨nh lu·∫≠n n√†y ƒë√£ b·ªã x√≥a]" khi c√≥ reply

#### üö® Report System

- User report posts/comments/users
- L√Ω do: spam, harassment, hate_speech, violence, etc.
- Moderator review v√† accept/reject
- T·ª± ƒë·ªông ban user khi b·ªã report 5 l·∫ßn ƒë∆∞·ª£c ch·∫•p nh·∫≠n

#### ü§ñ AI Features

1. **Ph√°t hi·ªán Toxic Content**

   - Spam detection
   - Hate speech detection
   - Harassment detection
   - S·ª≠ d·ª•ng PhoBERT fine-tuned tr√™n ViTHSD dataset

2. **Ph√¢n t√≠ch C·∫£m x√∫c**
   - Detect 8 emotions: joy, sadness, anger, fear, surprise, neutral, love, disgust
   - G·∫Øn m√†u n·ªÅn cho comment d·ª±a tr√™n emotion
   - Hi·ªÉn th·ªã g·ª£i √Ω n·∫øu detect anger

## üèóÔ∏è Ki·∫øn Tr√∫c

### Technology Stack

**Backend:**

- Node.js + Express.js
- MongoDB + Mongoose
- JWT Authentication
- Cloudinary (image/video storage)
- Google OAuth

**Frontend:**

- React 18
- Vite
- TailwindCSS + DaisyUI
- React Router
- React Query
- Zustand (state management)

**AI:**

- Python + FastAPI
- PyTorch
- Transformers (PhoBERT)
- TensorFlow

### C·∫•u Tr√∫c Th∆∞ M·ª•c

```
DoAnHTTM/
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.js          # MongoDB connection
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cloudinary.js        # Cloudinary config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js              # User schema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Category.js          # Category schema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Post.js              # Post schema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Comment.js           # Comment schema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Vote.js              # Vote schema
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Report.js            # Report schema
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userController.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoryController.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postController.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commentController.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voteController.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reportController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userRoutes.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoryRoutes.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postRoutes.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commentRoutes.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voteRoutes.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reportRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js              # Authentication & authorization
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validate.js          # Input validation
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload.js            # File upload
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.js                # Entry point
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/          # Button, Input, Modal, etc.
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/          # Header, Footer, Sidebar
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post/            # PostCard, PostList, PostForm
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comment/         # CommentItem, CommentList, CommentForm
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user/            # UserCard, UserProfile, UserBadge
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Register.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PostDetail.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreatePost.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Profile.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Category.jsx
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Admin/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js           # Axios instance
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authService.js
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postService.js
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commentService.js
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îú‚îÄ‚îÄ vite.config.js
‚îÇ       ‚îî‚îÄ‚îÄ tailwind.config.js
‚îÇ
‚îú‚îÄ‚îÄ ai/
‚îÇ   ‚îú‚îÄ‚îÄ toxic_detection/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model.py                 # PhoBERT model cho toxic detection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ train.py                 # Training script
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ predict.py               # Prediction script
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dataset/                 # ViTHSD dataset
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ checkpoints/             # Trained models
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ emotions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model.py                 # PhoBERT model cho emotion detection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ train.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ predict.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dataset/                 # Emotion dataset
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ checkpoints/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api.py                       # FastAPI service
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îÇ
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

## üóÑÔ∏è Database Schema

### User

```javascript
{
  username, email, password, googleId,
  avatar, bio, location, website,
  stats: { postsCount, commentsCount, upvotesReceived, downvotesReceived, ... },
  badge: "Newbie" | "Ng∆∞·ªùi t·ª´ng tr·∫£i" | "Chuy√™n gia" | "Xem ch√πa",
  role: "user" | "moderator" | "admin",
  restrictions: { canComment, canPost, bannedUntil, banReason }
}
```

### Category

```javascript
{
  name, slug, description,
  icon, color, coverImage,
  parentCategory,
  stats: { postsCount, commentsCount, viewsCount },
  settings: { isActive, requireApproval, allowImages, allowVideos },
  moderators: [userId]
}
```

### Post

```javascript
{
  title, slug, content,
  author, category,
  media: { images: [], videos: [] },
  tags: [],
  stats: { upvotes, downvotes, commentsCount, viewsCount },
  score,
  status: "draft" | "published" | "pending_approval" | "removed" | "spam",
  aiAnalysis: { isToxic, toxicScore, isSpam, spamScore }
}
```

### Comment

```javascript
{
  content, author, post,
  parentComment, depth,
  images: [],
  stats: { upvotes, downvotes, repliesCount },
  emotion: { label, confidence },
  aiAnalysis: { isToxic, toxicScore },
  isDeleted, deletedMessage
}
```

### Vote

```javascript
{
  user,
  targetType: "Post" | "Comment",
  targetId,
  voteType: "upvote" | "downvote"
}
```

### Report

```javascript
{
  reporter,
  targetType: "Post" | "Comment" | "User",
  targetId,
  reason: "spam" | "harassment" | "hate_speech" | ...,
  description,
  status: "pending" | "reviewing" | "accepted" | "rejected",
  reviewedBy, action
}
```

## üöÄ C√†i ƒê·∫∑t v√† Ch·∫°y

### Prerequisites

- Node.js >= 18
- MongoDB
- Python >= 3.9
- GPU (optional, cho training AI models)

### Backend Setup

```bash
cd web/backend
npm install
cp .env.example .env
# ƒêi·ªÅn th√¥ng tin v√†o .env
npm run dev
```

### Frontend Setup

```bash
cd web/frontend
npm install
npm run dev
```

### AI Service Setup

```bash
cd ai
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env
# Train models ho·∫∑c download pre-trained models
python api.py
```

## üìù API Endpoints

### Authentication

- `POST /api/auth/register` - ƒêƒÉng k√Ω
- `POST /api/auth/login` - ƒêƒÉng nh·∫≠p
- `GET /api/auth/google` - Google OAuth
- `POST /api/auth/refresh` - Refresh token

### Users

- `GET /api/users/:id` - L·∫•y profile
- `PUT /api/users/:id` - Update profile
- `POST /api/users/:id/avatar` - Upload avatar

### Categories

- `GET /api/categories` - L·∫•y t·∫•t c·∫£ categories
- `POST /api/categories` - T·∫°o category (admin)
- `PUT /api/categories/:id` - Update category (admin)

### Posts

- `GET /api/posts` - L·∫•y danh s√°ch posts (hot, new, top)
- `GET /api/posts/:slug` - L·∫•y chi ti·∫øt post
- `POST /api/posts` - T·∫°o post
- `PUT /api/posts/:id` - Update post
- `DELETE /api/posts/:id` - X√≥a post

### Comments

- `GET /api/comments?postId=xxx` - L·∫•y comments c·ªßa post
- `POST /api/comments` - T·∫°o comment
- `PUT /api/comments/:id` - Update comment
- `DELETE /api/comments/:id` - X√≥a comment

### Votes

- `POST /api/votes/upvote` - Upvote
- `POST /api/votes/downvote` - Downvote

### Reports

- `POST /api/reports` - T·∫°o report
- `GET /api/reports` - L·∫•y danh s√°ch reports (moderator)
- `PUT /api/reports/:id/accept` - Accept report (moderator)
- `PUT /api/reports/:id/reject` - Reject report (moderator)

### AI

- `POST /api/ai/toxic` - Detect toxic content
- `POST /api/ai/emotion` - Detect emotion
- `POST /api/ai/analyze` - Ph√¢n t√≠ch to√†n di·ªán

## üéØ C√°c Quy T·∫Øc Nghi·ªáp V·ª•

1. **Restrictions cho User m·ªõi:**

   - Ph·∫£i ƒëƒÉng k√Ω ƒë·ªß 1 ti·∫øng m·ªõi ƒë∆∞·ª£c ƒëƒÉng b√†i
   - Ph·∫£i comment √≠t nh·∫•t 3 l·∫ßn m·ªõi ƒë∆∞·ª£c ƒëƒÉng b√†i

2. **Badge/Bi·ªát hi·ªáu:**

   - **Newbie**: < 10 posts, < 50 comments
   - **Ng∆∞·ªùi t·ª´ng tr·∫£i**: 10-50 posts, 50-200 comments
   - **Chuy√™n gia**: > 50 posts ho·∫∑c > 200 comments ho·∫∑c > 500 upvotes
   - **Xem ch√πa**: < 5 posts, < 10 comments

3. **Moderation:**

   - B·ªã report 5 l·∫ßn (accepted) ‚Üí b·ªã c·∫•m comment 1 ng√†y
   - AI detect toxic v·ªõi confidence > 0.8 ‚Üí auto pending approval

4. **Score Calculation:**
   - Hot score: `net_votes / (age_hours + 2)^1.5`
   - Controversial: `min(upvotes, downvotes) * total_votes`

## üìä AI Models

### Toxic Detection

- Base: PhoBERT (vinai/phobert-base)
- Dataset: ViTHSD (Vietnamese Toxic & Hate Speech Detection)
- Classes: clean, spam, hate_speech, harassment
- Accuracy: ~85-90%

### Emotion Detection

- Base: PhoBERT
- Dataset: Custom Vietnamese emotion dataset
- Classes: joy, sadness, anger, fear, surprise, neutral, love, disgust
- Accuracy: ~80-85%

## üìÑ License

MIT

## üë• Contributors

[Your Name]
