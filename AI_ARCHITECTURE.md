# ü§ñ Ki·∫øn Tr√∫c AI - √ù T∆∞·ªüng & Tri·ªÉn Khai

## üìã T·ªïng Quan

H·ªá th·ªëng s·ª≠ d·ª•ng **2 m√¥ h√¨nh AI** ƒë·ªÉ n√¢ng cao tr·∫£i nghi·ªám v√† ki·ªÉm duy·ªát t·ª± ƒë·ªông:

1. **Toxic Detection** - Ph√°t hi·ªán spam, ng√¥n t·ª´ th√π gh√©t, toxic
2. **Emotion Detection** - Ph√¢n t√≠ch c·∫£m x√∫c ƒë·ªÉ t√πy ch·ªânh giao di·ªán

---

## üèóÔ∏è Ki·∫øn Tr√∫c H·ªá Th·ªëng

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         FORUM BACKEND (Node.js)         ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  User Post/Comment                      ‚îÇ
‚îÇ       ‚îÇ                                  ‚îÇ
‚îÇ       ‚ñº                                  ‚îÇ
‚îÇ  [AI Middleware]                        ‚îÇ
‚îÇ       ‚îÇ                                  ‚îÇ
‚îÇ       ‚îÇ HTTP Request                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       AI SERVICE (Python Flask)         ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Toxic      ‚îÇ  ‚îÇ    Emotion      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Detection   ‚îÇ  ‚îÇ   Detection     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  (PhoBERT)   ‚îÇ  ‚îÇ   (PhoBERT)     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  Return: JSON response                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**ƒê·∫∑c ƒëi·ªÉm:**

- ‚úÖ **T√°ch bi·ªát**: AI service ri√™ng, kh√¥ng ·∫£nh h∆∞·ªüng web backend
- ‚úÖ **Async**: Ph√¢n t√≠ch kh√¥ng block user
- ‚úÖ **Fallback**: N·∫øu AI l·ªói, h·ªá th·ªëng v·∫´n ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng

---

## üéØ √ù T∆∞·ªüng S·ª≠ D·ª•ng

### 1. Toxic Detection

**M·ª•c ƒë√≠ch:**

- T·ª± ƒë·ªông ph√°t hi·ªán n·ªôi dung ƒë·ªôc h·∫°i (hate speech, spam, offensive)
- Gi·∫£m c√¥ng vi·ªác moderator
- B·∫£o v·ªá c·ªông ƒë·ªìng

**Use Cases:**

```
User vi·∫øt comment: "M√†y ngu nh∆∞ heo"
                    ‚Üì
            [AI ph√¢n t√≠ch]
                    ‚Üì
        K·∫øt qu·∫£: Toxic (90%)
                    ‚Üì
        ‚Üí T·ª± ƒë·ªông pending review
        ‚Üí Notify moderator
        ‚Üí Warning cho user
```

**Dataset:** [ViTHSD](https://github.com/bakansm/ViTHSD) - Vietnamese Hate Speech Detection

**K·∫øt qu·∫£ AI:**

```json
{
  "is_toxic": true,
  "score": 0.92,
  "type": "hate_speech" // ho·∫∑c "spam", "offensive"
}
```

**X·ª≠ l√Ω:**

- Score > 0.8: T·ª± ƒë·ªông pending review
- Score 0.5-0.8: Warning cho user
- Score < 0.5: Cho ph√©p ƒëƒÉng

---

### 2. Emotion Detection

**M·ª•c ƒë√≠ch:**

- Ph√¢n t√≠ch c·∫£m x√∫c trong comment
- T√πy ch·ªânh UI theo c·∫£m x√∫c (m√†u n·ªÅn, icon)
- ƒê∆∞a ra l·ªùi khuy√™n ph√π h·ª£p

**8 C·∫£m X√∫c:**

- üòä Joy (vui v·∫ª)
- üò¢ Sadness (bu·ªìn)
- üò† Anger (t·ª©c gi·∫≠n)
- üò® Fear (s·ª£ h√£i)
- üò≤ Surprise (ng·∫°c nhi√™n)
- ü§¢ Disgust (gh√™ t·ªüm)
- ü§ù Trust (tin t∆∞·ªüng)
- üòê Neutral (trung l·∫≠p)

**Use Cases:**

```
User vi·∫øt: "T√¥i r·∫•t t·ª©c gi·∫≠n v·ªÅ v·∫•n ƒë·ªÅ n√†y!"
                    ‚Üì
            [AI ph√¢n t√≠ch]
                    ‚Üì
        K·∫øt qu·∫£: Anger (85%)
                    ‚Üì
        ‚Üí Hi·ªÉn th·ªã n·ªÅn m√†u ƒë·ªè nh·∫°t
        ‚Üí Icon üò†
        ‚Üí Suggestion: "H√£y b√¨nh tƒ©nh v√† th·∫£o lu·∫≠n vƒÉn minh nh√©!"
```

**Dataset:** `ai/emotions/dataset/*.xlsx` (s·∫µn c√≥ trong project)

**K·∫øt qu·∫£ AI:**

```json
{
  "emotion": "anger",
  "confidence": 0.85,
  "all_scores": {
    "anger": 0.85,
    "sadness": 0.1,
    "joy": 0.03,
    "neutral": 0.02
  }
}
```

**UI T√πy Ch·ªânh:**

- **Joy** ‚Üí N·ªÅn v√†ng nh·∫°t, khuy·∫øn kh√≠ch chia s·∫ª th√™m
- **Anger** ‚Üí N·ªÅn ƒë·ªè nh·∫°t, nh·∫Øc nh·ªü b√¨nh tƒ©nh
- **Sadness** ‚Üí N·ªÅn xanh nh·∫°t, g·ª£i √Ω support
- **Neutral** ‚Üí N·ªÅn x√°m (default)

---

## üîÑ Lu·ªìng Ho·∫°t ƒê·ªông

### Flow T·ªïng Qu√°t

```
1. User t·∫°o Post/Comment
         ‚Üì
2. Backend nh·∫≠n request
         ‚Üì
3. AI Middleware g·ªçi AI Service
         ‚Üì
4. AI Service ph√¢n t√≠ch content
   - Toxic Detection
   - Emotion Detection
         ‚Üì
5. Tr·∫£ k·∫øt qu·∫£ v·ªÅ Backend
         ‚Üì
6. L∆∞u k·∫øt qu·∫£ v√†o DB
   Post/Comment ‚Üí aiAnalysis: {...}
         ‚Üì
7. X·ª≠ l√Ω logic
   - N·∫øu toxic ‚Üí pending review
   - L∆∞u emotion ƒë·ªÉ hi·ªÉn th·ªã UI
         ‚Üì
8. Response v·ªÅ Frontend
         ‚Üì
9. Frontend hi·ªÉn th·ªã theo emotion
   - M√†u n·ªÅn
   - Icon
   - Suggestions
```

### Chi Ti·∫øt C√°c B∆∞·ªõc

**Backend (Node.js):**

1. Middleware nh·∫≠n content
2. G·ªçi AI API qua HTTP
3. Nh·∫≠n JSON response
4. L∆∞u v√†o field `aiAnalysis` c·ªßa Post/Comment

**AI Service (Python):**

1. Flask API nh·∫≠n request
2. Load models (PhoBERT)
3. Tokenize text
4. Predict v·ªõi models
5. Format k·∫øt qu·∫£ JSON
6. Return response

**Database:**

```javascript
// Post/Comment schema
aiAnalysis: {
  // Toxic
  isToxic: Boolean,
  toxicScore: Number,
  toxicType: String,

  // Emotion
  emotion: String,
  emotionScore: Number,

  analyzedAt: Date
}
```

**Frontend (React):**

- ƒê·ªçc `aiAnalysis.emotion`
- Apply class CSS t∆∞∆°ng ·ª©ng
- Hi·ªÉn th·ªã icon v√† suggestion

---

## üß™ H∆∞·ªõng Training Models

### 1. M√¥i Tr∆∞·ªùng Training

**N√™n d√πng:** Google Colab (GPU mi·ªÖn ph√≠)

**L√Ω do:**

- ‚úÖ GPU Tesla T4/P100 mi·ªÖn ph√≠
- ‚úÖ C√†i ƒë·∫∑t s·∫µn TensorFlow/PyTorch
- ‚úÖ Kh√¥ng c·∫ßn c·∫•u h√¨nh m√°y m·∫°nh
- ‚úÖ Share notebook d·ªÖ d√†ng

**Th∆∞ vi·ªán c·∫ßn:**

```
tensorflow==2.13.0
transformers==4.30.0
pandas
openpyxl
scikit-learn
```

---

### 2. Quy Tr√¨nh Training

#### A. Toxic Detection

**B∆∞·ªõc 1: Chu·∫©n b·ªã Dataset**

- Download [ViTHSD](https://github.com/bakansm/ViTHSD)
- Format: CSV v·ªõi 3 columns (text, label, type)
- Split: 80% train, 20% validation

**B∆∞·ªõc 2: Preprocessing**

- Tokenize b·∫±ng PhoBERT tokenizer
- Max length: 256 tokens
- Padding & truncation

**B∆∞·ªõc 3: Model Architecture**

```
PhoBERT (Pretrained)
        ‚Üì
[CLS] token pooling
        ‚Üì
Dropout (0.3)
        ‚Üì
Dense(3) + Softmax
        ‚Üì
Output: [clean, hate_speech, spam]
```

**B∆∞·ªõc 4: Training**

- Optimizer: Adam (lr=2e-5)
- Loss: Sparse Categorical Crossentropy
- Epochs: 5
- Batch size: 16
- Early stopping

**B∆∞·ªõc 5: Export**

- Save model: `toxic_detection_v1.h5`
- Save tokenizer: folder ri√™ng

**Target Metrics:**

- Accuracy: 85-90%
- F1-Score: ~0.85
- False Positive: <5%

---

#### B. Emotion Detection

**B∆∞·ªõc 1: Dataset**

- S·ª≠ d·ª•ng: `ai/emotions/dataset/*.xlsx` (ƒë√£ c√≥)
- 8 emotions: joy, sadness, anger, fear, surprise, disgust, trust, neutral

**B∆∞·ªõc 2-5: T∆∞∆°ng t·ª± Toxic Detection**

- Ch·ªâ kh√°c output layer: Dense(8) thay v√¨ Dense(3)

**Target Metrics:**

- Accuracy: 75-80%
- F1-Score (macro): ~0.75

---

### 3. Workflow Training

```
1. Upload notebook l√™n Google Colab
         ‚Üì
2. Mount Google Drive (l∆∞u dataset)
         ‚Üì
3. Install dependencies
         ‚Üì
4. Load & preprocess data
         ‚Üì
5. Build model (PhoBERT base)
         ‚Üì
6. Train (5-10 epochs)
         ‚Üì
7. Evaluate on validation set
         ‚Üì
8. Save model & tokenizer
         ‚Üì
9. Download v·ªÅ local: ai/toxic_detection/checkpoints/
         ‚Üì
10. Deploy v·ªõi Flask API
```

**Th·ªùi gian:**

- Setup: 10 ph√∫t
- Training toxic: 30-60 ph√∫t
- Training emotion: 30-60 ph√∫t
- Total: ~2 gi·ªù

---

## üöÄ Deployment & T√≠ch H·ª£p

### 1. AI Service (Python Flask)

**File:** `ai/api.py`

**Nhi·ªám v·ª•:**

- Load models (1 l·∫ßn khi start)
- Expose endpoint `/api/ai/analyze`
- Nh·∫≠n text ‚Üí tr·∫£ JSON

**Deploy:**

- Local: `python ai/api.py` (port 5000)
- Docker: Build image, run container
- Cloud: Deploy l√™n Heroku/Railway/Render

---

### 2. Backend Integration (Node.js)

**File:** `web/backend/utils/aiClient.js`

**Nhi·ªám v·ª•:**

- HTTP client g·ªçi AI service
- Handle timeout & errors
- Graceful fallback n·∫øu AI down

**File:** `web/backend/middleware/aiAnalysis.js`

**Nhi·ªám v·ª•:**

- Intercept request
- G·ªçi aiClient.analyze(content)
- Attach k·∫øt qu·∫£ v√†o req.aiAnalysis

**S·ª≠ d·ª•ng:**

```javascript
// routes/postRoutes.js
router.post('/', authenticate, aiAnalysis, createPost);
                                    ‚Üë
                             AI middleware
```

---

### 3. Database Schema

**Trong Post/Comment models:**

```javascript
aiAnalysis: {
  isToxic: Boolean,
  toxicScore: Number,
  toxicType: String,
  emotion: String,
  emotionScore: Number,
  analyzedAt: Date
}
```

**L∆∞u √Ω:**

- L∆∞u c·∫£ score ƒë·ªÉ c√≥ th·ªÉ tune threshold sau
- analyzedAt ƒë·ªÉ tracking

---

### 4. Frontend Display

**Emotion Colors:**

```javascript
const emotionStyles = {
  joy: "bg-yellow-50 border-yellow-200",
  anger: "bg-red-50 border-red-200",
  sadness: "bg-blue-50 border-blue-200",
  // ...
};
```

**Suggestions:**

```javascript
const emotionAdvice = {
  anger: "H√£y b√¨nh tƒ©nh v√† th·∫£o lu·∫≠n vƒÉn minh nh√©!",
  sadness: "M·ªçi chuy·ªán s·∫Ω ·ªïn th√¥i, h√£y chia s·∫ª v·ªõi c·ªông ƒë·ªìng!",
  // ...
};
```

**Component:**

```jsx
<CommentItem comment={comment}>
  <div className={emotionStyles[comment.aiAnalysis.emotion]}>
    {comment.content}
    {comment.aiAnalysis.emotion === "anger" && (
      <Alert>{emotionAdvice.anger}</Alert>
    )}
  </div>
</CommentItem>
```

---

## ‚öôÔ∏è Optimization & Best Practices

### 1. Performance

**Caching:**

- Cache k·∫øt qu·∫£ AI trong 1 gi·ªù
- Gi·ªëng n·ªôi dung ‚Üí d√πng cache, kh√¥ng g·ªçi l·∫°i AI

**Async Processing:**

- Kh√¥ng block user khi ƒëƒÉng
- G·ªçi AI b·∫•t ƒë·ªìng b·ªô, update sau

**Batch Processing:**

- N·∫øu c√≥ nhi·ªÅu comments c√πng l√∫c
- G·ªçi AI theo batch ƒë·ªÉ t·ªëi ∆∞u

### 2. Error Handling

**AI Service Down:**

- Fallback: Cho ph√©p ƒëƒÉng, ƒë√°nh d·∫•u "ch∆∞a ph√¢n t√≠ch"
- Kh√¥ng block user experience

**Low Confidence:**

- Score < 0.5: Kh√¥ng tin c·∫≠y
- ‚Üí B·ªè qua k·∫øt qu·∫£, ƒë·ªÉ moderator review

### 3. Privacy & Ethics

**Kh√¥ng l∆∞u:**

- Raw content trong AI service
- Ch·ªâ analyze r·ªìi tr·∫£ k·∫øt qu·∫£

**Transparent:**

- Hi·ªÉn th·ªã cho user bi·∫øt ƒëang d√πng AI
- Cho ph√©p report n·∫øu AI sai

---

## üìä Monitoring

### Metrics C·∫ßn Theo D√µi

**AI Service:**

- Latency (target: <100ms)
- Success rate (target: >99%)
- Error rate

**Accuracy:**

- User reports (AI sai)
- Moderator overrides
- False positive rate

**Usage:**

- Requests per day
- Most common emotions
- Toxic rate (% toxic content)

---

## üéØ Roadmap

### Phase 1: MVP (Hi·ªán t·∫°i)

- [x] 2 models: Toxic + Emotion
- [x] Basic integration
- [x] Simple UI (emotion colors)

### Phase 2: Improvements

- [ ] Fine-tune models v·ªõi data t·ª´ forum
- [ ] Multi-language support
- [ ] Sarcasm detection

### Phase 3: Advanced

- [ ] Real-time suggestions khi typing
- [ ] Context-aware detection (thread history)
- [ ] Personalized emotion analysis

---

## üìù T√≥m T·∫Øt

### ‚úÖ Ki·∫øn Tr√∫c

- **T√°ch bi·ªát**: Web Backend ‚Üî AI Service (HTTP)
- **Models**: PhoBERT-based (Vietnamese optimized)
- **Deployment**: Flask API + Docker

### ‚úÖ Training

- **M√¥i tr∆∞·ªùng**: Google Colab (GPU free)
- **Datasets**: ViTHSD + emotions/\*.xlsx
- **Th·ªùi gian**: ~2 gi·ªù total

### ‚úÖ T√≠ch H·ª£p

- **Backend**: Middleware ‚Üí AI Client ‚Üí Database
- **Frontend**: Emotion styles + Suggestions
- **Optimization**: Caching + Async + Fallback

### ‚úÖ Features

- **Toxic Detection**: Auto review (>80%), warning (50-80%)
- **Emotion Detection**: 8 emotions, UI colors, advice
- **UX**: Kh√¥ng block user, graceful degradation

---

**K·∫øt lu·∫≠n:** H·ªá th·ªëng AI ƒë∆°n gi·∫£n, d·ªÖ tri·ªÉn khai, t·∫≠p trung v√†o tr·∫£i nghi·ªám ng∆∞·ªùi d√πng! üöÄ
